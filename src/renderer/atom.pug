doctype xml

mixin objTree(obj, allowed)
  each val, index in obj
    - let isAllowed = allowed === false || allowed.indexOf(index) !== -1
    if !isAllowed
    else if index === 'link'
      link&attributes(val)
    else if typeof val === 'string'
      #{index}= val
    else
      #{index}
        +objTree(val, false)

feed(xmlns='http://www.w3.org/2005/Atom')
  +objTree(site, 'title,subtitle,rights,author,icon,id,link'.split(','))
  each post in posts
    entry
      id= post.id
      link(href=`${site.link.href}${post.id}`)
      summary(type='html')= post.briefHTML
      title= post.title
      published= post.published.toISOString()
      updated= post.updated.toISOString()
      each tag in post.tags
        category(term=tag)/
